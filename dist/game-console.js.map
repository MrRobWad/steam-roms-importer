{"version":3,"sources":["../src/game-console.js"],"names":["GameConsole","jsonFilePath","jsonData","JSON","parse","readFileSync","name","shortName","tags","prefix","icon","romPaths","extensions","emulators","emulator","length","configPath","join","__dirname","resolve","normalize","searchGames","emulatorName","emulatorNames","keys","games","dir","entries","readdirSync","entry","p","s","statSync","isFile","ext","extname","replace","indexOf","push"],"mappings":"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","file":"game-console.js","sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\nimport Game from './game';\r\nimport _ from 'lodash';\r\n\r\nexport default class GameConsole {\r\n    constructor(jsonFilePath)\r\n    {\r\n        let jsonData = JSON.parse(fs.readFileSync(jsonFilePath));\r\n\r\n        this.name = jsonData.name || '';\r\n        this.shortName = jsonData.shortName || '';\r\n        this.tags = jsonData.tags || [];\r\n        this.prefix = jsonData.prefix || '';\r\n        this.icon = jsonData.icon || '';\r\n        this.romPaths = jsonData.romPaths || [];\r\n        this.extensions = jsonData.extensions || [];\r\n        this.emulators = {};\r\n        this.emulator = jsonData.emulator || 0;\r\n\r\n        if (this.icon && this.icon.length)\r\n        {\r\n            let configPath = path.join(__dirname, 'config', 'icons');\r\n\r\n            this.icon = path.resolve(configPath, path.normalize(this.icon));\r\n        }\r\n\r\n        this.searchGames();\r\n    }\r\n\r\n    updateFromJsonFile(jsonFilePath)\r\n    {\r\n        let jsonData = JSON.parse(fs.readFileSync(jsonFilePath));\r\n        \r\n        this.name = jsonData.name || this.name;\r\n        this.shortName = jsonData.shortName || this.shortName;\r\n        this.tags = jsonData.tags || this.tags;\r\n        this.prefix = jsonData.prefix || this.prefix;\r\n        this.icon = jsonData.icon || this.icon;\r\n        this.romPaths = jsonData.romPaths || this.romPaths;\r\n        this.extensions = jsonData.extensions || this.extensions;\r\n        this.emulator = jsonData.emulator || this.emulator;\r\n\r\n        if (this.icon && this.icon.length)\r\n        {\r\n            let configPath = path.join(__dirname, 'config', 'icons');\r\n\r\n            this.icon = path.resolve(configPath, path.normalize(this.icon));\r\n        }\r\n\r\n        this.searchGames();\r\n    }\r\n\r\n    addEmulator(emulatorName, emulator)\r\n    {\r\n        this.emulators[emulatorName] = emulator;\r\n    }\r\n\r\n    getEmulator()\r\n    {\r\n        let emulatorNames = _.keys(this.emulators);\r\n\r\n        if (!emulatorNames.length)\r\n            return null;\r\n\r\n        if (!this.emulator)\r\n            return this.emulators[emulatorNames[0]];\r\n\r\n        return this.emulators[this.emulator];\r\n    }\r\n\r\n    searchGames()\r\n    {\r\n        let games = [];\r\n\r\n        for (let dir of this.romPaths)\r\n        {\r\n            let entries = fs.readdirSync(path.normalize(dir));\r\n            \r\n            for (let entry of entries)\r\n            {\r\n                let p = path.join(dir, entry);\r\n                let s = fs.statSync(p);\r\n\r\n                if (!s.isFile())\r\n                    continue;\r\n\r\n                let ext = path.extname(entry).replace(/^\\./, '');\r\n\r\n                if (this.extensions.indexOf(ext) != -1)\r\n                    games.push(new Game(this, p));\r\n            }\r\n        }\r\n\r\n        this.games = games;\r\n    }\r\n}"]}