{"version":3,"sources":["../src/shortcuts-loader.js"],"names":["getSteamConfigPath","loadShortcutsFile","generateShortcuts","users","readdirSync","length","console","error","filePath","Promise","resolve","reject","join","shortcutFile","callback","consoles","shortcutsFile","games","each","gameConsole","name","searchGames","emulator","getEmulator","game","gameShortcut","appname","prefix","cleanName","exe","getCommandForGame","icon","tags","replace","ignore","shortcut","addShortcut","push","gameName","consoleName","appid","getAppID","writeShortcuts"],"mappings":";;;;;QAOgBA,kB,GAAAA,kB;QAYAC,iB,GAAAA,iB;QAYAC,iB,GAAAA,iB;;AA/BhB;;;;AAEA;;;;AACA;;;;AAEA;;;;;;AAEO,SAASF,kBAAT,GACP;AACI,QAAIG,QAAQ,aAAGC,WAAH,CAAe,wCAAf,CAAZ;;AAEA,QAAI,CAACD,KAAD,IAAU,CAACA,MAAME,MAArB,EACIC,QAAQC,KAAR,CAAc,4BAAd;;AAEJ,QAAIC,WAAW,2CAA2CL,MAAM,CAAN,CAA3C,GAAsD,SAArE;;AAEA,WAAOK,QAAP;AACH;;AAEM,SAASP,iBAAT,GACP;AACI,WAAO,IAAIQ,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EACnB;AACI,YAAIH,WAAW,eAAKI,IAAL,CAAUZ,oBAAV,EAAgC,eAAhC,CAAf;;AAEA,YAAIa,eAAe,2BAAiBL,QAAjB,CAAnB;;AAEA,eAAOE,QAAQG,YAAR,CAAP;AACH,KAPM,CAAP;AAQH;;AAEM,SAASX,iBAAT,OAAsDY,QAAtD,EACP;AAAA,QADmCC,QACnC,QADmCA,QACnC;AAAA,QAD6CC,aAC7C,QAD6CA,aAC7C;;AACI,QAAIC,QAAQ,EAAZ;;AAEA,qBAAEC,IAAF,CAAOH,QAAP,EAAiB,UAACI,WAAD,EAAcC,IAAd,EACjB;AACID,oBAAYE,WAAZ;AACA,YAAIC,WAAWH,YAAYI,WAAZ,EAAf;;AAEA,YAAI,CAACD,QAAL,EACI;;AAEJ,yBAAEJ,IAAF,CAAOC,YAAYF,KAAnB,EAA0B,UAACO,IAAD,EAC1B;AACI,gBAAIC,eAAe;AACfC,yBAASP,YAAYQ,MAAZ,GAAqB,GAArB,GAA2BH,KAAKI,SAD1B;AAEfC,qBAAKP,SAASQ,iBAAT,CAA2BN,IAA3B,CAFU;AAGfO,sBAAMZ,YAAYY,IAHH;AAIfC,sBAAMb,YAAYa;AAJH,aAAnB;;AAOAP,yBAAaC,OAAb,GAAuBD,aAAaC,OAAb,CAAqBO,OAArB,CAA6B,KAA7B,EAAoC,EAApC,EAAwCA,OAAxC,CAAgD,KAAhD,EAAuD,EAAvD,CAAvB;;AAEA,gBAAI,CAACT,KAAKU,MAAV,EACA;AACI,oBAAIC,WAAWnB,cAAcoB,WAAd,CAA0BX,YAA1B,CAAf;;AAEAR,sBAAMoB,IAAN,CAAW;AACPC,8BAAUd,KAAKI,SADR;AAEPW,iCAAapB,YAAYC,IAFlB;AAGPoB,2BAAOL,SAASM,QAAT;AAHA,iBAAX;AAKH;AACJ,SArBD;AAsBH,KA9BD;;AAgCAzB,kBAAc0B,cAAd,CAA6B,UAACnC,KAAD;AAAA,eAAWO,SAASP,KAAT,EAAgBA,QAAQ,EAAR,GAAaU,KAA7B,CAAX;AAAA,KAA7B;AACH","file":"shortcuts-loader.js","sourcesContent":["import ShortcutFile from './shortcut-file';\r\n\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nimport _ from 'lodash';\r\n\r\nexport function getSteamConfigPath()\r\n{\r\n    let users = fs.readdirSync(\"C:/Program Files (x86)/Steam/userdata/\");\r\n\r\n    if (!users || !users.length)\r\n        console.error('No steam directory found !');\r\n\r\n    let filePath = \"C:/Program Files (x86)/Steam/userdata/\" + users[0] + \"/config\";\r\n\r\n    return filePath;\r\n}\r\n\r\nexport function loadShortcutsFile()\r\n{\r\n    return new Promise((resolve, reject) =>\r\n    {\r\n        let filePath = path.join(getSteamConfigPath(), 'shortcuts.vdf');\r\n\r\n        let shortcutFile = new ShortcutFile(filePath);\r\n\r\n        return resolve(shortcutFile);\r\n    });\r\n}\r\n\r\nexport function generateShortcuts({consoles, shortcutsFile}, callback)\r\n{\r\n    let games = [];\r\n\r\n    _.each(consoles, (gameConsole, name) =>\r\n    {\r\n        gameConsole.searchGames();\r\n        let emulator = gameConsole.getEmulator();\r\n\r\n        if (!emulator)\r\n            return;\r\n\r\n        _.each(gameConsole.games, (game) =>\r\n        {\r\n            let gameShortcut = {\r\n                appname: gameConsole.prefix + ' ' + game.cleanName,\r\n                exe: emulator.getCommandForGame(game),\r\n                icon: gameConsole.icon,\r\n                tags: gameConsole.tags,\r\n            }\r\n\r\n            gameShortcut.appname = gameShortcut.appname.replace(/^ +/, '').replace(/ +$/, '');\r\n\r\n            if (!game.ignore)\r\n            {\r\n                let shortcut = shortcutsFile.addShortcut(gameShortcut);\r\n\r\n                games.push({\r\n                    gameName: game.cleanName,\r\n                    consoleName: gameConsole.name,\r\n                    appid: shortcut.getAppID()\r\n                });\r\n            }\r\n        });\r\n    });\r\n\r\n    shortcutsFile.writeShortcuts((error) => callback(error, error ? [] : games));\r\n}"]}