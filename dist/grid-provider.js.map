{"version":3,"sources":["../src/grid-provider.js"],"names":["findGridImages","searchSteamGridDB","game","callback","Promise","resolve","reject","replace","url","encodeURIComponent","get","set","end","err","res","ok","message","images","data","JSON","parse","text","d","push","image","thumbnail","searchConsoleGridDB","console","shortCodes","findShortCode","c","toUpperCase","shortCode","indexOf","split","gridProviders","concat","searchFunction","then","catch","e","error"],"mappings":"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","file":"grid-provider.js","sourcesContent":["import async from 'async';\r\nimport superagent from 'superagent';\r\n\r\nlet searchSteamGridDB = (game, callback) =>\r\n{\r\n    return new Promise((resolve, reject) =>\r\n    {\r\n        game = game.replace(/ - /gi, ': ').replace(/-/gi, ' ').replace(/CD {0,1}[0-9]/gi, '').replace(/ +/gi, ' ').replace(/ $/, '');\r\n        let url = `http://www.steamgriddb.com/search.php?name=${encodeURIComponent(game)}`;\r\n\r\n        superagent\r\n            .get(url)\r\n            .set('Accept', 'application/json')\r\n            .end((err, res) =>\r\n            {\r\n                if (err || !res.ok) \r\n                    return reject({message: 'could not get '});\r\n\r\n                let images = [];\r\n                let data = JSON.parse(res.text);\r\n\r\n                for (let d of data)\r\n                {\r\n                    if (!(typeof d === 'object'))\r\n                        continue;\r\n\r\n                    if (d['grid_link'])\r\n                        images.push({\r\n                            image: d['grid_link'],\r\n                            thumbnail: d['thumbnail_link']\r\n                        });\r\n                }\r\n\r\n                return resolve(images);\r\n            });\r\n    });\r\n}\r\n\r\nlet searchConsoleGridDB = (game, console) =>\r\n{\r\n    return new Promise((resolve, reject) =>\r\n    {\r\n        let shortCodes = {\r\n            'N64': ['NINTENDO64'],\r\n            'SNES': ['SUPERNES', 'SUPERNINTENDO', 'SUPERFAMICOM', 'SFC', 'SFM'],\r\n            'NES': ['NES', 'FAMICOM', 'NINTENDO', 'NINTENDOENTERTAINMENTSYSTEM'],\r\n            'GAMEBOY': ['GB', 'NINTENDOGAMEBOY', 'NINTENDOGB', 'NGB', 'GAMEBOYCOLOR', 'GBC', 'NINTENDOGAMEBOYCOLOR', 'NINTENDOGBC', 'NGBC', 'SUPERGAMEBOY', 'SGB', 'NINTENDOSUPERGAMEBOY', 'NINTENDOSGB', 'NSGB'],\r\n            'GAMECUBE': ['GC', 'NGC', 'NINTENDOGC', 'NINTENDOGAMECUBE', 'DOLPHIN', 'NINTENDODOLPHIN'],\r\n            'WII': ['NINTENDOWII'],\r\n            'GBA': ['GAMEBOYADVANCE', 'GAMEBOYADVANCESP', 'NINTENDOGBA', 'GBADVANCE', 'NINTENDOGBADVANCE', 'GBAM', 'GBASP', 'GAMEBOYADVANCEMICRO', 'GBAMICRO'],\r\n            'DS': ['NINTENDODS', 'NDS', 'DUALSCREEN', 'NINTENDODUALSCREEN', 'DSLITE', 'DSI', 'DSILITE', 'NINTENDODSLITE'],\r\n            'PS1': ['PLAYSTATION', 'SONYPLAYSTATION', 'PSX', 'PS', 'SONYPSX']\r\n        }\r\n\r\n        let findShortCode = (console) =>\r\n        {\r\n            let c = console.replace(/\\s/g, '').toUpperCase();\r\n\r\n            for (let shortCode in shortCodes)\r\n            {\r\n                if (shortCodes[shortCode].indexOf(c) != -1)\r\n                    return shortCode;\r\n            }\r\n\r\n            return console;\r\n        }\r\n\r\n        game = game.replace('-', ' ').replace(/CD {0-1}[0-9]/gi, '').replace(/ +/gi, ' ').replace(/ $/, '');\r\n\r\n        let url = `http://consolegrid.com/api/top_picture?console=${findShortCode(console)}&game=${encodeURIComponent(game)}`;\r\n\r\n        superagent\r\n            .get(url)\r\n            .end((err, res) =>\r\n            {\r\n                if (err || !res.ok) \r\n                    return reject({message: 'could not get anything from consolegrid'});\r\n\r\n                let images = [];\r\n                let data = res.text.split('\\n');\r\n\r\n                for (let d of data)\r\n                {\r\n                    images.push({\r\n                        image: d,\r\n                        thumbnail: d\r\n                    });\r\n                }\r\n\r\n                return resolve(images);\r\n            });\r\n    });\r\n}\r\n\r\nlet gridProviders = [\r\n    searchSteamGridDB,\r\n    searchConsoleGridDB\r\n];\r\n\r\nexport function findGridImages (game, console=\"\")\r\n{\r\n    return new Promise((resolve, reject) =>\r\n    {\r\n        async.concat(\r\n            gridProviders, \r\n            (searchFunction, callback) =>\r\n            {\r\n                searchFunction(game, console)\r\n                    .then((images) => callback(null, images))\r\n                    .catch((e) => callback(null, []));\r\n            },\r\n            (error, images) =>\r\n            {\r\n                resolve(images);\r\n            }\r\n        );\r\n    });\r\n}"]}